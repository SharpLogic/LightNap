<ln-api-response [apiResponse]="profile$" errorMessage="Error loading profile" loadingMessage="Loading profile...">
  <ng-template #success let-profileAny>
    @let profile = asProfile(profileAny);

    <p-panel data-cy="profile-panel" header="Manage Your Profile">
      <ng-template #icons>
        <p-button data-cy="profile-logout" (onClick)="logOut()" label="Log Out" severity="danger" size="small" icon="pi pi-sign-out" />
      </ng-template>
      <div class="flex flex-col gap-2">
        <div data-cy="profile-info" class="flex flex-col gap-1">
          <label for="userName" class="font-semibold">User Name</label>
          <span id="userName">{{ profile.userName }}</span>
        </div>

        <div data-cy="profile-info" class="flex flex-col gap-1">
          <label for="email" class="font-semibold">Email</label>
          <span id="email">{{ profile.email }} (<a data-cy="profile-change-email" [routerLink]="'change-email' | route">change</a>)</span>
        </div>

        <div class="flex flex-col gap-1">
          <label for="preferredLanguage" class="font-semibold">Preferred Language</label>
            <ln-preferred-language-select data-cy="profile-language-select" id="preferredLanguage" class="w-40" />
        </div>

        <form [formGroup]="form" (ngSubmit)="updateProfile()" autocomplete="off">
          <div class="flex flex-col w-80 gap-5">

            <ln-error-list data-cy="profile-errors" [errors]="errors()" />
            <p-button data-cy="profile-submit" type="submit" label="Update Profile" styleClass="w-full" [disabled]="!form.valid || !form.dirty" />
          </div>
        </form>
      </div>
    </p-panel>
  </ng-template>
</ln-api-response>
